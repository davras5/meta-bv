<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBL Datenkatalog</title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        /* === 1. VARIABLES & RESET === */
        :root {
            --swiss-red: #DC0018;
            --text-black: #222;
            --text-dark: #333;
            --text-light: #666;
            --border: #CCC;
            --border-light: #E5E5E5;
            --bg-gray: #F5F5F5;
            --bg-hover: #F2F4F5;
            --footer-bg: #454545;
            --link-color: #06C;
            --font-stack: "Frutiger", "Helvetica Neue", Helvetica, Arial, sans-serif;
            
            --spacing-xs: 8px;
            --spacing-sm: 15px;
            --spacing-md: 20px;
            --spacing-lg: 30px;
            --spacing-xl: 50px;
            
            --radius-sm: 3px;
            --radius-md: 4px;
            --radius-pill: 20px;
            
            --shadow-card: 0 2px 5px rgba(0,0,0,0.02);
            --shadow-card-hover: 0 10px 25px rgba(0,0,0,0.08);
        }

        *, *::before, *::after { box-sizing: border-box; }
        
        body { 
            margin: 0; 
            font-family: var(--font-stack); 
            color: var(--text-dark); 
            background: white;
            -webkit-font-smoothing: antialiased;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        a { text-decoration: none; color: inherit; cursor: pointer; }
        .hidden { display: none !important; }

        .material-symbols-rounded {
            font-size: 20px;
            vertical-align: middle;
            user-select: none;
        }

        /* === 2. LAYOUT === */
        .u-max-width {
            max-width: 1160px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            width: 100%;
        }

        .container { flex: 1; }

        /* === 3. HEADER & BRANDING === */
        header { padding-top: var(--spacing-lg); padding-bottom: var(--spacing-md); }
        
        .header-inner {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .branding { display: flex; align-items: flex-start; gap: var(--spacing-md); }
        
        .logo-wrapper {
            width: 40px; 
            height: 40px; 
            flex-shrink: 0;
        }
        
        .logo-wrapper img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: contain;
        }

        .branding-text {
            border-left: 1px solid #999;
            padding-left: var(--spacing-md);
            font-size: 16px;
            line-height: 1.3;
        }
        .branding-text strong { display: block; font-weight: 700; color: var(--text-black); }
        .branding-text span { display: block; color: var(--text-black); font-size: 15px; }

        .top-meta { 
            font-size: 14px; 
            display: flex; 
            gap: 25px; 
            color: var(--text-black);
            align-items: center; 
        }
        
        .lang-selector { 
            display: flex; 
            align-items: center; 
            gap: 2px; 
            cursor: pointer; 
        }
        .lang-selector .material-symbols-rounded { font-size: 18px; }

        /* === 4. NAVIGATION === */
        .nav-tabs {
            margin-top: 45px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            gap: 35px;
        }
        .nav-link {
            padding-bottom: var(--spacing-sm);
            font-size: 16px;
            color: var(--text-black);
            cursor: pointer;
        }
        .nav-link.active {
            font-weight: bold;
            color: var(--swiss-red);
            border-bottom: 4px solid var(--swiss-red);
            margin-bottom: -1px;
        }

        /* === 5. BREADCRUMBS & ACTIONS === */
        .sub-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 0;
        }
        .breadcrumbs { font-size: 14px; color: var(--text-light); }
        .breadcrumbs span { margin: 0 var(--spacing-xs); color: #999; }
        .breadcrumbs a:hover { text-decoration: underline; }

        .action-icons { display: flex; gap: 12px; color: #666; }
        .icon-btn { 
            cursor: pointer; 
            padding: var(--spacing-xs);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .icon-btn:hover { background-color: var(--bg-gray); color: var(--swiss-red); }
        .icon-btn .material-symbols-rounded { font-size: 22px; }

        /* === 6. PAGE TITLE & TOOLBAR === */
        h1.page-title {
            font-size: 32px;
            font-weight: 400;
            margin: 10px 0 40px 0;
            color: var(--text-black);
        }
        
        .page-title-h2 {
            font-size: 32px !important;
            font-weight: 400 !important;
            margin: 10px 0 40px 0 !important;
            color: var(--text-black) !important;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        .search-group { display: flex; gap: var(--spacing-sm); width: 100%; max-width: 500px; }
        .input-wrapper { position: relative; flex-grow: 1; }
        .input-wrapper input {
            width: 100%; 
            padding: 10px var(--spacing-sm) 10px 48px;
            border: 1px solid #999; 
            border-radius: var(--radius-sm); 
            font-size: 16px; 
            height: 46px;
        }
        .search-icon {
            position: absolute; 
            left: 14px; 
            top: 50%; 
            transform: translateY(-50%);
            color: #666; 
            pointer-events: none; 
            font-size: 22px;
        }
        
        .btn-filter {
            height: 46px; 
            padding: 0 24px; 
            background: white;
            border: 1px solid var(--text-dark); 
            border-radius: var(--radius-sm);
            font-size: 15px; 
            font-weight: bold;
            display: flex; 
            align-items: center; 
            gap: var(--spacing-xs); 
            cursor: pointer;
        }

        .view-toggles { display: flex; gap: 10px; }
        .toggle-icon {
            width: 46px; 
            height: 46px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: var(--radius-sm); 
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toggle-icon.active { background: #666; color: white; pointer-events: none; }
        .toggle-icon.inactive { background: white; color: var(--text-dark); border: 1px solid var(--border); }
        .toggle-icon.inactive:hover { background: var(--bg-gray); }

        /* === 7. CARDS & GRID === */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: 80px;
        }
        }
        @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }

        .card {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            overflow: hidden;
            display: flex; 
            flex-direction: column;
            box-shadow: var(--shadow-card);
            transition: all 0.2s;
            cursor: pointer;
            max-width: 360px;
            width: 100%;
        }
        .card:hover {
            box-shadow: var(--shadow-card-hover);
            transform: translateY(-3px);
            border-color: var(--border);
        }
        .card-img-wrap { height: 220px; position: relative; background: #eee; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        .tags-overlay { position: absolute; top: var(--spacing-md); left: var(--spacing-md); display: flex; gap: 10px; }

        .card-body { padding: var(--spacing-lg); display: flex; flex-direction: column; flex-grow: 1; }
        .card-title { font-size: 16px; font-weight: 700; margin: 0 0 var(--spacing-sm) 0; color: var(--text-black); }
        .card-desc { font-size: 16px; line-height: 1.5; color: var(--text-black); margin: 0 0 35px 0; flex-grow: 1; }
        .card-footer { display: flex; justify-content: space-between; align-items: flex-end; }
        .tags-bottom { display: flex; flex-wrap: wrap; gap: var(--spacing-xs); }

        .btn-arrow {
            width: 40px; 
            height: 40px; 
            border: 1px solid var(--border-light); 
            border-radius: 2px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            color: var(--swiss-red); 
            flex-shrink: 0; 
            transition: all 0.2s;
        }
        .btn-arrow:hover { border-color: var(--swiss-red); background: var(--swiss-red); color: white; }

        /* === 8. TAG PILL (Universal) === */
        .tag-pill {
            background: white;
            border: 1px solid #999;
            padding: var(--spacing-xs) 14px;
            border-radius: var(--radius-pill);
            font-size: 14px;
            color: #444;
            font-weight: 400;
            cursor: pointer;
            display: inline-block;
            white-space: nowrap;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .tag-pill:hover {
            background-color: var(--border-light);
            border-color: #666;
            color: #000;
        }

        /* === 9. LIST VIEW === */
        .list-table { width: 100%; border-collapse: collapse; font-size: 15px; margin-bottom: 80px; }
        .list-table th {
            text-align: left; 
            background: var(--bg-hover); 
            padding: var(--spacing-sm);
            color: #666; 
            font-size: 13px; 
            font-weight: 700; 
            text-transform: uppercase;
        }
        .list-table td { 
            padding: var(--spacing-md) var(--spacing-sm); 
            border-bottom: 1px solid var(--border-light); 
            vertical-align: middle; 
        }
        .list-table tbody tr { cursor: pointer; transition: background-color 0.1s; }
        .list-table tbody tr:hover { background-color: var(--bg-hover); }
        
        .col-title { font-weight: 700; font-size: 16px; color: var(--text-black); width: 25%; }
        .col-desc { color: var(--text-black); line-height: 1.5; }
        .col-tags { width: 30%; text-align: right; }

        /* === 10. DETAIL VIEW === */
        .detail-hero { display: flex; gap: var(--spacing-xl); margin-bottom: 60px; margin-top: var(--spacing-md); }
        .detail-info { flex: 1; }
        .detail-image-box { flex: 1; max-width: 600px; }
        .detail-image-box img { width: 100%; height: auto; border-radius: 2px; }
        .detail-tags { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 25px; }
        .detail-desc { font-size: 16px; line-height: 1.6; margin-bottom: var(--spacing-lg); }

        .responsible-box {
            background: var(--bg-gray); 
            padding: var(--spacing-lg); 
            margin: var(--spacing-xl) 0; 
            border-left: 5px solid #ddd;
        }
        .box-title { font-weight: bold; margin-bottom: var(--spacing-xs); font-size: 18px; }
        .box-text { font-size: 16px; font-style: italic; color: #666; }

        .section-title { font-size: 24px; font-weight: 400; margin: var(--spacing-xl) 0 25px 0; }

        /* === 11. DATA ROWS (Shared pattern) === */
        .data-row {
            display: flex;
            padding: 16px var(--spacing-sm);
            border-bottom: 1px solid var(--border-light);
            font-size: 16px;
            align-items: center;
            transition: background-color 0.1s;
        }
        .data-row:hover { background-color: var(--bg-hover); }
        .data-row-key { width: 280px; font-weight: 400; flex-shrink: 0; color: var(--text-black); }
        .data-row-val { color: var(--text-dark); display: flex; align-items: center; flex-wrap: wrap; gap: var(--spacing-xs); line-height: 1.5; }

        .meta-list, .distributions-list, .publications-list { border-top: 1px solid var(--border-light); }

        /* === 12. DISTRIBUTION ACCORDION === */
        .distribution-item { border-bottom: 1px solid var(--border-light); }
        
        .distribution-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px var(--spacing-sm);
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .distribution-header:hover { background-color: var(--bg-hover); }
        
        .distribution-left { color: var(--text-black); flex-grow: 1; }
        .distribution-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: var(--text-light);
        }
        .distribution-right .expand-icon {
            font-size: 24px;
            transition: transform 0.2s ease;
        }
        .distribution-item.expanded .expand-icon { transform: rotate(180deg); }
        .distribution-format { font-size: 14px; font-weight: 500; }
        
        .distribution-details {
            display: none;
            padding: 0 var(--spacing-sm) var(--spacing-md) var(--spacing-sm);
            background-color: #FAFAFA;
        }
        .distribution-item.expanded .distribution-details { display: block; }
        
        .distribution-detail-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 15px;
        }
        .distribution-detail-row:last-child { border-bottom: none; }
        .distribution-detail-key { width: 200px; flex-shrink: 0; color: var(--text-light); }
        .distribution-detail-val { color: var(--text-black); word-break: break-all; }

        /* === 13. ATTRIBUTES TABLE === */
        .attr-table { width: 100%; border-collapse: collapse; font-size: 16px; margin-top: var(--spacing-md); }
        .attr-table th {
            text-align: left; 
            background: var(--bg-hover); 
            padding: 16px;
            color: #666; 
            font-size: 13px; 
            font-weight: 700; 
            text-transform: uppercase;
        }
        .attr-table td { 
            padding: 16px; 
            border-bottom: 1px solid var(--border-light); 
            vertical-align: top; 
            line-height: 1.5; 
        }
        .attr-table tbody tr:hover { background-color: var(--bg-hover); }

        /* === 14. CONTENT PAGES (About, Handbuch) === */
        .content-page { padding-bottom: 80px; }
        .content-page h2 { font-size: 28px; font-weight: 700; margin-top: var(--spacing-xl); margin-bottom: var(--spacing-md); }
        .content-page h3 { font-size: 24px; font-weight: 700; margin-top: 40px; margin-bottom: var(--spacing-sm); }
        .content-page p { font-size: 16px; line-height: 1.6; margin-bottom: var(--spacing-md); }
        .content-page ul { list-style-type: disc; padding-left: 25px; margin-bottom: var(--spacing-md); }
        .content-page li { font-size: 16px; line-height: 1.6; margin-bottom: var(--spacing-xs); }
        .content-page strong { font-weight: 700; }
        .content-page .info-link { margin-top: var(--spacing-lg); }
        .content-page a:not(.footer-link) { color: var(--link-color); text-decoration: underline; }
        .content-page a:not(.footer-link):hover { text-decoration: none; }
        
        .handbuch-img {
            display: block;
            max-width: 100%;
            height: auto;
            margin: var(--spacing-lg) 0;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
        }

        /* === 15. FOOTER === */
        footer {
            background-color: var(--footer-bg);
            color: white;
            height: 40px;
            margin-top: auto;
            display: flex;
            align-items: center;
        }
        .footer-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .footer-left { display: flex; gap: var(--spacing-lg); }
        .footer-link {
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .footer-link:hover { text-decoration: underline; }
        .footer-link .material-symbols-rounded { font-size: 16px; }
        .footer-right { color: #ccc; }

        /* === 16. DETAIL VIEW LINKS === */
        #view-concept-detail a:not(.footer-link),
        #view-dataset-detail a:not(.footer-link) {
            color: var(--link-color);
            text-decoration: underline;
        }
        #view-concept-detail a:not(.footer-link):hover,
        #view-dataset-detail a:not(.footer-link):hover {
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="container u-max-width">
        <header>
            <div class="header-inner">
                <div class="branding">
                    <div class="logo-wrapper">
                        <img src="https://raw.githubusercontent.com/davras5/meta-bv/212ee3a88abba781fd699543b02df718e68fde63/Coat_of_arms_of_Switzerland.svg.png" alt="Wappen der Schweiz">
                    </div>
                    <div class="branding-text">
                        <strong>Bundesamt für Bauten und Logistik BBL</strong>
                        <span>Bereich Bauten</span>
                        <span>Datenkatalog</span>
                    </div>
                </div>
                <div class="top-meta">
                    <a href="#">Kontakt</a>
                    <a href="#">Export</a>
                    <div class="lang-selector">DE <span class="material-symbols-rounded">expand_more</span></div>
                </div>
            </div>

            <nav class="nav-tabs" id="nav-tabs">
                <div class="nav-link active" data-page="concept">Konzepte</div>
                <div class="nav-link" data-page="dataset">Datensätze</div>
                <div class="nav-link" data-page="about">über diesen Datenkatalog</div>
                <div class="nav-link" data-page="handbuch">Handbuch</div>
            </nav>
        </header>

        <div class="sub-header">
            <div class="breadcrumbs" id="breadcrumbs">
                Startseite <span>&gt;</span> Konzepte
            </div>
            <div class="action-icons">
                <div class="icon-btn" title="Print"><span class="material-symbols-rounded">print</span></div>
                <div class="icon-btn" title="Share"><span class="material-symbols-rounded">share</span></div>
            </div>
        </div>

        <main>
            <!-- Catalog Views -->
            <div id="view-concept-catalog">
                <h1 class="page-title">Konzepte</h1>
                <div class="toolbar">
                    <div class="search-group">
                        <div class="input-wrapper">
                            <span class="material-symbols-rounded search-icon">search</span>
                            <input type="text" id="search-concept" placeholder="Suchen">
                        </div>
                        <button class="btn-filter">
                            <span class="material-symbols-rounded">filter_list</span>
                            Filter anzeigen
                        </button>
                    </div>
                    <div class="view-toggles">
                        <div class="toggle-icon active" data-view="grid" data-type="concept">
                            <span class="material-symbols-rounded">grid_view</span>
                        </div>
                        <div class="toggle-icon inactive" data-view="list" data-type="concept">
                            <span class="material-symbols-rounded">view_list</span>
                        </div>
                    </div>
                </div>
                <div id="concept-grid" class="grid"></div>
                <table id="concept-list" class="list-table hidden">
                    <thead>
                        <tr>
                            <th>KONZEPT</th>
                            <th>BESCHREIBUNG</th>
                            <th style="text-align:right">SCHLÜSSELWÖRTER</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="view-dataset-catalog" class="hidden">
                <h1 class="page-title">Datenkatalog</h1>
                <div class="toolbar">
                    <div class="search-group">
                        <div class="input-wrapper">
                            <span class="material-symbols-rounded search-icon">search</span>
                            <input type="text" id="search-dataset" placeholder="Suchen">
                        </div>
                        <button class="btn-filter">
                            <span class="material-symbols-rounded">filter_list</span>
                            Filter anzeigen
                        </button>
                    </div>
                    <div class="view-toggles">
                        <div class="toggle-icon active" data-view="grid" data-type="dataset">
                            <span class="material-symbols-rounded">grid_view</span>
                        </div>
                        <div class="toggle-icon inactive" data-view="list" data-type="dataset">
                            <span class="material-symbols-rounded">view_list</span>
                        </div>
                    </div>
                </div>
                <div id="dataset-grid" class="grid"></div>
                <table id="dataset-list" class="list-table hidden">
                    <thead>
                        <tr>
                            <th>DATENSATZ</th>
                            <th>BESCHREIBUNG</th>
                            <th style="text-align:right">SCHLÜSSELWÖRTER</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Detail Views -->
            <div id="view-concept-detail" class="hidden">
                <h1 class="page-title" id="detail-concept-title"></h1>
                <div class="detail-hero">
                    <div class="detail-info">
                        <div class="detail-tags" id="detail-concept-tags"></div>
                        <p class="detail-desc" id="detail-concept-desc"></p>
                    </div>
                    <div class="detail-image-box">
                        <img id="detail-concept-img" src="" alt="">
                    </div>
                </div>
                <div class="responsible-box">
                    <div class="box-title">Verantwortliche Person</div>
                    <div class="box-text">Niemand fühlt sich für diesen Datensatz zuständig – höchste Zeit, jemandem diese Ehre zu erteilen!</div>
                </div>
                <h3 class="section-title">Metadaten</h3>
                <div class="meta-list" id="detail-concept-meta"></div>
                <h3 class="section-title">Standards</h3>
                <div class="meta-list" id="detail-concept-standards"></div>
                <h3 class="section-title">Attribute</h3>
                <table class="attr-table">
                    <thead>
                        <tr>
                            <th style="width:20%">NAME</th>
                            <th style="width:15%">FORMAT</th>
                            <th style="width:10%">SCHLÜSSEL</th>
                            <th style="width:15%">WERTELISTE</th>
                            <th>BESCHREIBUNG</th>
                        </tr>
                    </thead>
                    <tbody id="detail-concept-attrs"></tbody>
                </table>
                <div style="height:100px;"></div>
            </div>

            <div id="view-dataset-detail" class="hidden">
                <h1 class="page-title" id="detail-dataset-title"></h1>
                <div class="detail-hero">
                    <div class="detail-info">
                        <p class="detail-desc" id="detail-dataset-desc"></p>
                        <div class="detail-tags" id="detail-dataset-tags"></div>
                    </div>
                    <div class="detail-image-box">
                        <img id="detail-dataset-img" src="" alt="">
                    </div>
                </div>
                <div class="responsible-box">
                    <div class="box-title">Verantwortliche Person</div>
                    <div class="box-text">Niemand fühlt sich für diesen Datensatz zuständig – höchste Zeit, jemandem diese Ehre zu erteilen!</div>
                </div>
                <h3 class="section-title">Metadaten</h3>
                <div class="meta-list" id="detail-dataset-meta"></div>
                <h3 class="section-title">Bereitstellungsformen</h3>
                <div class="distributions-list" id="detail-dataset-distributions"></div>
                <h3 class="section-title">Publikationen in externen Katalogen</h3>
                <div class="publications-list" id="detail-dataset-publications"></div>
                <div style="height:100px;"></div>
            </div>

            <!-- Content Pages -->
            <div id="view-about" class="hidden content-page">
                <h1 class="page-title">Über diesen Datenkatalog</h1>
                <div id="about-content"></div>
            </div>

            <div id="view-handbuch" class="hidden content-page">
                <h1 class="page-title">Handbuch</h1>
                <div id="handbuch-content"></div>
            </div>
        </main>
    </div>

    <footer>
        <div class="footer-inner u-max-width">
            <div class="footer-left">
                <a href="https://www.admin.ch/gov/de/start/rechtliches.html" target="_blank" class="footer-link">
                    <span class="material-symbols-rounded">open_in_new</span>
                    Rechtliche Grundlagen
                </a>
                <a href="https://github.com/davras5/meta-bv/" target="_blank" class="footer-link">
                    <span class="material-symbols-rounded">open_in_new</span>
                    Quellcode (GitHub)
                </a>
            </div>
            <div class="footer-right">
                Version 1.0.0
            </div>
        </div>
    </footer>

    <script>
    (function() {
        // === STATE ===
        const state = {
            data: { concept: [], dataset: [] },
            view: { concept: 'grid', dataset: 'grid' },
            filter: { concept: '', dataset: '' },
            contentLoaded: { about: false, handbuch: false }
        };

        // === CONFIG ===
        const config = {
            views: ['view-concept-catalog', 'view-dataset-catalog', 'view-concept-detail', 'view-dataset-detail', 'view-about', 'view-handbuch'],
            metaFields: {
                concept: [
                    { key: 'fachliche_id', label: 'Fachliche ID', type: 'pill' },
                    { key: 'guid', label: 'GUID', type: 'text' },
                    { key: 'termdat', label: 'TERMDAT', type: 'link' },
                    { key: 'fachbereich', label: 'Fachbereich', type: 'text' },
                    { key: 'system', label: 'Führendes System', type: 'text' },
                    { key: 'klassifizierung', label: 'Klassifizierung', type: 'pill' },
                    { key: 'personenbezogen', label: 'Personenbezogene Daten', type: 'pill' },
                    { key: 'kommentar', label: 'Kommentar', type: 'text' },
                    { key: 'version', label: 'Version', type: 'text' }
                ],
                dataset: [
                    { key: 'kontaktstelle', label: 'Kontaktstelle', type: 'text' },
                    { key: 'ausgabedatum', label: 'Ausgabedatum', type: 'text' },
                    { key: 'aktualisierungsintervall', label: 'Aktualisierungsintervall', type: 'pill' },
                    { key: 'status', label: 'Status', type: 'pill' },
                    { key: 'klassifizierung', label: 'Klassifizierung', type: 'pill' },
                    { key: 'personenbezogen', label: 'Personenbezogene Daten', type: 'pill' },
                    { key: 'archivwuerdig', label: 'Archivwürdig', type: 'pill' },
                    { key: 'schluesselwoerter', label: 'Schlüsselwörter', type: 'pills' },
                    { key: 'thema', label: 'Thema', type: 'pill' },
                    { key: 'rechtsgrundlage', label: 'Rechtsgrundlage', type: 'text' },
                    { key: 'kommentar', label: 'Kommentar', type: 'text' }
                ]
            },
            distributionFields: [
                { key: 'identifikator', label: 'Identifikator' },
                { key: 'titel', label: 'Titel', fallback: 'name' },
                { key: 'zugriffsUrl', label: 'Zugriffs-URL', isLink: true },
                { key: 'downloadUrl', label: 'Download-URL', isLink: true },
                { key: 'status', label: 'Status' },
                { key: 'dateiformat', label: 'Dateiformat', fallback: 'format' },
                { key: 'lizenz', label: 'Lizenz' },
                { key: 'bemerkungen', label: 'Zusätzliche Bemerkungen' }
            ]
        };

        // === UTILITIES ===
        const $ = (sel, ctx = document) => ctx.querySelector(sel);
        const $$ = (sel, ctx = document) => ctx.querySelectorAll(sel);

        function formatValue(val, type) {
            if (!val || val === '-') return '-';
            if (type === 'pill') return `<span class="tag-pill">${val}</span>`;
            if (type === 'pills' && Array.isArray(val)) return val.map(v => `<span class="tag-pill">${v}</span>`).join('');
            if (type === 'link' && val.startsWith('http')) return `<a href="${val}" target="_blank">${val}</a>`;
            return val;
        }

        function createDataRow(label, value, type = 'text') {
            return `<div class="data-row"><div class="data-row-key">${label}</div><div class="data-row-val">${formatValue(value, type)}</div></div>`;
        }

        function createTags(tags) {
            return tags.map(t => `<span class="tag-pill">${t}</span>`).join('');
        }

        function filterItems(items, filter) {
            if (!filter) return items;
            const f = filter.toLowerCase();
            return items.filter(i => 
                i.title.toLowerCase().includes(f) ||
                i.description.toLowerCase().includes(f) ||
                [...(i.topTags || []), ...(i.bottomTags || [])].some(t => t.toLowerCase().includes(f))
            );
        }

        // === DATA LOADING ===
        async function loadData() {
            try {
                const [conceptRes, datasetRes] = await Promise.all([
                    fetch('data/concepts.json'),
                    fetch('data/datasets.json').catch(() => ({ ok: false }))
                ]);
                
                state.data.concept = await conceptRes.json();
                state.data.dataset = datasetRes.ok ? await datasetRes.json() : [];
            } catch (e) {
                console.error('Data load failed:', e);
            }
        }

        async function loadContent(type) {
            if (state.contentLoaded[type]) return;
            try {
                const res = await fetch(`content/${type}.html`);
                if (res.ok) {
                    $(`#${type}-content`).innerHTML = await res.text();
                    state.contentLoaded[type] = true;
                }
            } catch (e) {
                console.error(`Failed to load ${type}.html:`, e);
            }
        }

        // === RENDERING ===
        function renderCatalog(type) {
            const items = filterItems(state.data[type], state.filter[type]);
            const isGrid = state.view[type] === 'grid';
            
            const gridEl = $(`#${type}-grid`);
            const listEl = $(`#${type}-list`);
            
            gridEl.classList.toggle('hidden', !isGrid);
            listEl.classList.toggle('hidden', isGrid);

            if (isGrid) {
                gridEl.innerHTML = items.map(item => `
                    <div class="card" data-id="${item.id}">
                        <div class="card-img-wrap">
                            <img src="${item.image}" class="card-img" alt="${item.title}">
                            <div class="tags-overlay">${createTags(item.topTags || [])}</div>
                        </div>
                        <div class="card-body">
                            <h3 class="card-title">${item.title}</h3>
                            <p class="card-desc">${item.description}</p>
                            <div class="card-footer">
                                <div class="tags-bottom">${createTags((item.bottomTags || []).slice(0, 3))}</div>
                                <div class="btn-arrow"><span class="material-symbols-rounded">arrow_forward</span></div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                $('tbody', listEl).innerHTML = items.map(item => {
                    const allTags = [...(item.topTags || []), ...(item.bottomTags || [])];
                    return `
                        <tr data-id="${item.id}">
                            <td class="col-title">${item.title}</td>
                            <td class="col-desc">${item.description}</td>
                            <td class="col-tags">${allTags.map(t => `<span class="tag-pill" style="margin-left:5px;margin-bottom:5px;">${t}</span>`).join('')}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function renderDetail(type, id) {
            const item = state.data[type].find(x => x.id === id);
            if (!item) return navigate(type);

            showView(`view-${type}-detail`);
            setActiveTab(type);
            setBreadcrumbs(`${type}-detail`, item.title);

            // Common fields
            $(`#detail-${type}-title`).textContent = item.title;
            $(`#detail-${type}-desc`).textContent = item.fullDescription || item.description;
            $(`#detail-${type}-img`).src = item.image || '';
            $(`#detail-${type}-tags`).innerHTML = createTags([...(item.topTags || []), ...(item.bottomTags || [])]);

            // Metadata
            const metaHtml = item.meta 
                ? config.metaFields[type].map(f => createDataRow(f.label, item.meta[f.key], f.type)).join('')
                : '<div class="data-row">Keine Metadaten</div>';
            $(`#detail-${type}-meta`).innerHTML = metaHtml;

            // Type-specific rendering
            if (type === 'concept') {
                renderConceptSpecific(item);
            } else {
                renderDatasetSpecific(item);
            }
        }

        function renderConceptSpecific(item) {
            // Standards
            const stdHtml = item.standards?.length
                ? item.standards.map(s => createDataRow(s.name, s.value)).join('')
                : '<div class="data-row">Keine Standards definiert</div>';
            $('#detail-concept-standards').innerHTML = stdHtml;

            // Attributes
            const attrHtml = item.attributes?.length
                ? item.attributes.map(a => `
                    <tr>
                        <td>${a.name}</td>
                        <td><span class="tag-pill">${a.format}</span></td>
                        <td>${a.key === '-' ? '-' : `<span class="tag-pill">${a.key}</span>`}</td>
                        <td>${a.list === '-' ? '-' : `<span class="tag-pill">${a.list}</span>`}</td>
                        <td>${a.desc}</td>
                    </tr>
                `).join('')
                : '<tr><td colspan="5">Keine Attribute definiert</td></tr>';
            $('#detail-concept-attrs').innerHTML = attrHtml;
        }

        function renderDatasetSpecific(item) {
            // Distributions
            const distContainer = $('#detail-dataset-distributions');
            if (item.distributions?.length) {
                distContainer.innerHTML = item.distributions.map((d, i) => {
                    const icon = ['Excel', 'XLSX', 'XLS', 'CSV'].includes(d.format) ? 'description' : 'code';
                    const detailRows = config.distributionFields.map(f => {
                        const val = d[f.key] || d[f.fallback] || '';
                        const display = f.isLink && val ? `<a href="${val}" target="_blank">${val}</a>` : (val || '-');
                        return `<div class="distribution-detail-row"><div class="distribution-detail-key">${f.label}</div><div class="distribution-detail-val">${display}</div></div>`;
                    }).join('');

                    return `
                        <div class="distribution-item" data-index="${i}">
                            <div class="distribution-header">
                                <div class="distribution-left">${d.name}</div>
                                <div class="distribution-right">
                                    <span class="material-symbols-rounded">${icon}</span>
                                    <span class="distribution-format">${d.format}</span>
                                    <span class="material-symbols-rounded expand-icon">expand_more</span>
                                </div>
                            </div>
                            <div class="distribution-details">${detailRows}</div>
                        </div>
                    `;
                }).join('');
            } else {
                distContainer.innerHTML = '<div class="data-row">Keine Bereitstellungsformen definiert</div>';
            }

            // Publications
            const pubHtml = item.publications?.length
                ? item.publications.map(p => createDataRow(p.catalog, p.value)).join('')
                : '<div class="data-row">Keine externen Publikationen</div>';
            $('#detail-dataset-publications').innerHTML = pubHtml;
        }

        // === NAVIGATION ===
        function showView(viewId) {
            config.views.forEach(id => $(`#${id}`).classList.add('hidden'));
            $(`#${viewId}`).classList.remove('hidden');
        }

        function setActiveTab(page) {
            $$('.nav-link').forEach(tab => tab.classList.remove('active'));
            const tabPage = (page === 'concept-detail') ? 'concept' : (page === 'dataset-detail') ? 'dataset' : page;
            $(`.nav-link[data-page="${tabPage}"]`)?.classList.add('active');
        }

        function setBreadcrumbs(page, title = '') {
            const crumbs = { 
                concept: 'Konzepte', 
                dataset: 'Datenkatalog', 
                about: 'Über diesen Datenkatalog', 
                handbuch: 'Handbuch' 
            };
            
            let html = `<a href="#/concept">Startseite</a> <span>&gt;</span> `;
            
            if (page.includes('-detail')) {
                const type = page.replace('-detail', '');
                html += `<a href="#/${type}">${crumbs[type]}</a> <span>&gt;</span> ${title}`;
            } else {
                html += crumbs[page] || page;
            }
            
            $('#breadcrumbs').innerHTML = html;
        }

        function navigate(page) {
            showView(`view-${page}-catalog`);
            setActiveTab(page);
            setBreadcrumbs(page);
            renderCatalog(page);
        }

        async function handleRoute() {
            const hash = window.location.hash;
            const [, type, id] = hash.split('/');

            if (type === 'concept' && id) {
                renderDetail('concept', id);
            } else if (type === 'dataset' && id) {
                renderDetail('dataset', id);
            } else if (type === 'about') {
                await loadContent('about');
                showView('view-about');
                setActiveTab('about');
                setBreadcrumbs('about');
            } else if (type === 'handbuch') {
                await loadContent('handbuch');
                showView('view-handbuch');
                setActiveTab('handbuch');
                setBreadcrumbs('handbuch');
            } else if (type === 'dataset') {
                navigate('dataset');
            } else {
                navigate('concept');
            }
        }

        // === EVENT HANDLERS ===
        function setupEventListeners() {
            // Navigation tabs
            $('#nav-tabs').addEventListener('click', e => {
                const tab = e.target.closest('.nav-link');
                if (tab) window.location.hash = `#/${tab.dataset.page}`;
            });

            // View toggles (delegated)
            document.addEventListener('click', e => {
                const toggle = e.target.closest('.toggle-icon');
                if (!toggle || toggle.classList.contains('active')) return;

                const type = toggle.dataset.type;
                const view = toggle.dataset.view;
                
                state.view[type] = view;
                
                // Update toggle buttons
                $$(`[data-type="${type}"]`).forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === view);
                    btn.classList.toggle('inactive', btn.dataset.view !== view);
                });
                
                renderCatalog(type);
            });

            // Card/row clicks (delegated)
            document.addEventListener('click', e => {
                const card = e.target.closest('.card');
                const row = e.target.closest('tr[data-id]');
                const target = card || row;
                
                if (!target) return;
                
                const container = target.closest('[id^="view-"]');
                if (!container) return;
                
                const type = container.id.includes('concept') ? 'concept' : 'dataset';
                window.location.hash = `#/${type}/${target.dataset.id}`;
            });

            // Distribution accordion (delegated)
            document.addEventListener('click', e => {
                const header = e.target.closest('.distribution-header');
                if (header) {
                    header.closest('.distribution-item').classList.toggle('expanded');
                }
            });

            // Search inputs
            ['concept', 'dataset'].forEach(type => {
                $(`#search-${type}`)?.addEventListener('input', e => {
                    state.filter[type] = e.target.value.toLowerCase();
                    renderCatalog(type);
                });
            });

            // Hash change
            window.addEventListener('hashchange', handleRoute);
        }

        // === INIT ===
        async function init() {
            await loadData();
            setupEventListeners();
            handleRoute();
        }

        init();

        // Debug exposure
        window.catalogState = state;
    })();
    </script>
</body>
</html>
